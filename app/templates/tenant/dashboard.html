{% extends 'base.html' %}
{% block title %}{{ _('Tenant Dashboard') }}{% endblock %}

{% block content %}
<style>
/* لوحة متكاملة وعصرية */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

/* كروت ملونة وجذابة */
.card-tenant {
  border-radius: 20px;
  padding: 25px;
  background: linear-gradient(145deg, #ffffff, #f0f0f5);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  transition: 0.4s;
  cursor: pointer;
  position: relative;
}
.card-tenant:hover {
  transform: translateY(-8px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
}

/* أيقونات في الكروت */
.card-tenant .icon {
  font-size: 2.2rem;
  position: absolute;
  top: 20px;
  right: 20px;
  opacity: 0.15;
}

/* العناوين والنصوص */
.card-tenant h6 {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 8px;
}
.card-tenant .small-text {
  font-size: 0.85rem;
  color: #6c757d;
  margin-bottom: 5px;
}

/* شريط الحالة */
.badge-status {
  padding: 5px 10px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
}

/* ألوان الحالات */
.bg-new { background: #0d6efd; color: #fff; }
.bg-in_progress { background: #ffc107; color: #212529; }
.bg-resolved { background: #198754; color: #fff; }
.bg-closed { background: #6c757d; color: #fff; }
.bg-active { background: #198754; color: #fff; }
.bg-pending { background: #ffc107; color: #212529; }
.bg-expired { background: #6c757d; color: #fff; }
.bg-paid { background: #198754; color: #fff; }
.bg-unpaid { background: #ffc107; color: #212529; }

</style>

<h3 class="mb-4">{{ _('Tenant Dashboard') }}</h3>

<!-- إجراءات سريعة -->
<div class="dashboard-grid mb-4">
  <a class="card-tenant text-decoration-none text-dark" href="{{ url_for('tenant.maintenance_create') }}">
    <i class="bi bi-tools icon"></i>
    <h6>{{ _('New Maintenance Request') }}</h6>
    <div class="small-text">{{ _('Report an issue or request service') }}</div>
  </a>
  <a class="card-tenant text-decoration-none text-dark" href="{{ url_for('tenant.complaint_create') }}">
    <i class="bi bi-exclamation-triangle icon"></i>
    <h6>{{ _('New Complaint') }}</h6>
    <div class="small-text">{{ _('Submit a complaint to management') }}</div>
  </a>
</div>

<!-- عقودي ومدفوعاتي -->
<div class="dashboard-grid">
  {% for c in contracts %}
  <div class="card-tenant">
    <i class="bi bi-file-earmark-text icon"></i>
    <h6>{{ _('Contract') }} #{{ c.id }}</h6>
    <div class="small-text">{{ c.property.title }}</div>
    <div class="small-text">{{ _('Start') }}: {{ c.start_date }} — {{ _('End') }}: {{ c.end_date }}</div>
    {% set status_class = {
        'active':'bg-active',
        'pending':'bg-pending',
        'expired':'bg-expired'
    }[c.status] %}
    <span class="badge-status {{ status_class }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No contracts available') }}</div>
  {% endfor %}

  {% for p in payments %}
  <div class="card-tenant">
    <i class="bi bi-currency-dollar icon"></i>
    <h6>{{ _('Payment') }} #{{ p.id }}</h6>
    <div class="small-text">{{ _('Amount') }}: {{ p.amount }}</div>
    <div class="small-text">{{ _('Due') }}: {{ p.due_date }}</div>
    {% set pay_class = 'bg-paid' if p.status=='paid' else 'bg-unpaid' %}
    <span class="badge-status {{ pay_class }}">{{ p.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No payments available') }}</div>
  {% endfor %}
</div>

<!-- طلبات الصيانة والشكاوى -->
<h5 class="mb-3">{{ _('Maintenance & Complaints') }}</h5>
<div class="dashboard-grid">
  {% for m in maintenance_requests %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.maintenance_show', request_id=m.id) }}'">
    <i class="bi bi-tools icon"></i>
    <h6>{{ m.title }}</h6>
    <div class="small-text">{{ m.description }}</div>
    {% if m.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ m.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ m.created_at }}</div>
    {% set m_class = {
      'new': 'bg-new',
      'in_progress': 'bg-in_progress',
      'resolved': 'bg-resolved',
      'closed': 'bg-closed'
    }[m.status] %}
    <span class="badge-status {{ m_class }}">{{ m.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No maintenance requests') }}</div>
  {% endfor %}

  {% for c in complaints %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.complaint_show', complaint_id=c.id) }}'">
    <i class="bi bi-exclamation-triangle icon"></i>
    <h6>{{ c.subject }}</h6>
    <div class="small-text">{{ c.description }}</div>
    {% if c.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ c.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ c.created_at }}</div>
    {% set c_class = {
      'new': 'bg-new',
      'reviewing': 'bg-in_progress',
      'resolved': 'bg-resolved',
      'closed': 'bg-closed'
    }[c.status] %}
    <span class="badge-status {{ c_class }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No complaints') }}</div>
  {% endfor %}
</div>
{% endblock %}
