{% extends 'base.html' %}
{% block title %}{{ _('Tenant Dashboard') }}{% endblock %}

{% block content %}
<style>
/* شبكة الكروت */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

/* كرت المعلومات */
.card-tenant {
  border-radius: 15px;
  padding: 20px;
  background: #fff;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  transition: 0.3s;
  cursor: pointer;
}
.card-tenant:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 25px rgba(0,0,0,0.15);
}

.card-tenant h6 {
  font-weight: 600;
  margin-bottom: 8px;
}

.card-tenant .badge {
  font-size: 0.85rem;
}

.card-tenant .small-text {
  font-size: 0.8rem;
  color: #6c757d;
}

/* ألوان الحالة */
.bg-new { background-color: #0d6efd; color: #fff; }
.bg-in_progress { background-color: #ffc107; color: #212529; }
.bg-resolved { background-color: #198754; color: #fff; }
.bg-closed { background-color: #6c757d; color: #fff; }
.bg-active { background-color: #198754; color: #fff; }
.bg-pending { background-color: #ffc107; color: #212529; }
.bg-expired { background-color: #6c757d; color: #fff; }
.bg-paid { background-color: #198754; color: #fff; }
.bg-unpaid { background-color: #ffc107; color: #212529; }

.card-header {
  font-weight: 700;
  margin-bottom: 12px;
}
</style>

<h3 class="mb-4">{{ _('Tenant Dashboard') }}</h3>

<!-- عقودي والمدفوعات -->
<div class="dashboard-grid">
  {% for c in contracts %}
  <div class="card-tenant">
    <h6>{{ _('Contract') }} #{{ c.id }} - {{ c.property.title }}</h6>
    <div class="small-text">{{ _('Start') }}: {{ c.start_date }} — {{ _('End') }}: {{ c.end_date }}</div>
    {% set status_class = {
        'active':'bg-active',
        'pending':'bg-pending',
        'expired':'bg-expired'
    }[c.status] %}
    <span class="badge {{ status_class }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No contracts available') }}</div>
  {% endfor %}

  {% for p in payments %}
  <div class="card-tenant">
    <h6>{{ _('Payment') }} #{{ p.id }}</h6>
    <div class="small-text">{{ _('Amount') }}: {{ p.amount }}</div>
    <div class="small-text">{{ _('Due') }}: {{ p.due_date }}</div>
    {% set pay_class = 'bg-paid' if p.status=='paid' else 'bg-unpaid' %}
    <span class="badge {{ pay_class }}">{{ p.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No payments available') }}</div>
  {% endfor %}
</div>

<!-- طلبات الصيانة والشكاوى -->
<h5 class="mb-3">{{ _('Maintenance & Complaints') }}</h5>
<div class="dashboard-grid">
  {% for m in maintenance_requests %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.maintenance_show', request_id=m.id) }}'">
    <h6>{{ m.title }}</h6>
    <div class="small-text">{{ m.description }}</div>
    {% if m.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ m.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ m.created_at }}</div>
    <span class="badge {{ m.status }}">{{ m.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No maintenance requests') }}</div>
  {% endfor %}

  {% for c in complaints %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.complaint_show', complaint_id=c.id) }}'">
    <h6>{{ c.subject }}</h6>
    <div class="small-text">{{ c.description }}</div>
    {% if c.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ c.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ c.created_at }}</div>
    <span class="badge {{ c.status }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No complaints') }}</div>
  {% endfor %}
</div>

{% endblock %}
